<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" href="css/reset.css"/>
<link rel="stylesheet" href="css/pullToRefresh.css"/>
<script src="js/iscroll.js"></script>
<script src="js/pullToRefresh.js"></script>
<script src="js/colorful.js"></script>
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Font Awesome -->

<!-- Bootstrap -->
<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
<!-- Page style -->

<!-- Cards style -->
<link rel="stylesheet" href="css/cards-style.css" type="text/css" />

<style type="text/css" media="all">
body, html {
	padding: 0;
	margin: 0;
	height: 100%;
	font-family: Arial, Microsoft YaHei;
	color: #111;
}
a{
	font-size:2px;
}

</style>
</head>
<body>
<!--must content ul li,or shoupi-->
<div id="wrapper">
  <ul id='uli'>
  </ul>
</div>
<div id="mess" value="没有更多了"><div>
<script>


function utcToDate(utcCurrTime) {
            utcCurrTime = utcCurrTime + "";
            var date = "";
            var month = new Array();
            month["Jan"] = 1;
            month["Feb"] = 2;
            month["Mar"] = 3;
            month["Apr"] = 4;
            month["May"] = 5;
            month["Jun"] = 6;
            month["Jul"] = 7;
            month["Aug"] = 8;
            month["Sep"] = 9;
            month["Oct"] = 10;
            month["Nov"] = 11;
            month["Dec"] = 12;
            var week = new Array();
            week["Mon"] = "一";
            week["Tue"] = "二";
            week["Wed"] = "三";
            week["Thu"] = "四";
            week["Fri"] = "五";
            week["Sat"] = "六";
            week["Sun"] = "日";

            str = utcCurrTime.split(" ");
            date = str[3]+ "-"+month[str[1]] + "-" + str[2];
            return date;
        }

var Top=55;//全局变量
var myDate=new Date();//全局变量时间
var time=utcToDate(myDate);//全局变量
var ulh=0;//ul的高度

var Purl=[];//遗留的视频图片
var Pname=[];
var Ptitle=[];
var Ptype=[];
var Pcontent=[];
var Pcreatetime=[];

var ttop=0;//指针
function loadData(){
	var url=[];//小版的视频图片
	var name=[];
	var title=[];
	var type=[];
	var content=[];
	var createtime=[];
	//time="2017-3-24 10:23:24"
	//alert(time);

	var tag=0;
	$.getJSON("http://bc.runbros.com/api/card/getCard.php?time="+time,function(data){

				//alert("ok");
				var now;//最后一个图片创建的时间
				$.each(data.card,function(i,term){
					//alert(term.cimg);
					url.push(term.cimg);
					name.push(term.cname);
					title.push(term.ctitle);
					type.push(term.ccardtype);
					content.push(term.ccontent);
					createtime.push(term.ccreatetime);
					time=term.ccreatetime;
						//alert(time);
						tag=1;
						//alert(tag);
				});

				var len=url.length;

				for(var i=0;i<len;i++){

					//如果是横版的话
					if(type[i]==2){

						var html="<li style='position:absolute;height:240px;width:340px;top:"+Top+"px;left:-5px'><div class='col-md-4'>";
								html+="<div class='card card-blog'>"
								html+="<div class='card-image'>";
								html+="<a href='#'> <img class='img img-raised' style='height:180px;width:280px' src='"+url[i]+"'> </a>";
								html+="<div class='ripple-cont'></div>";
								html+="</div>";
								html+="<div class='table'>";
								html+="<div style='height:20px;overflow:hidden'><a style='font-size:2px'>"+name[i]+"</a></div>";
								html+="</div>";
								html+="</div>";
								html+="</div></li>";
								$("#uli").append(html);
								ulh+=250;
								$("#uli").height(ulh);
								Top+=250;
						}
						//如果是竖版
						if(type[i]==1){
							//如果栈里没有元素就压栈
							if(ttop==0){
									//alert(ttop);
								Purl[++ttop]=url[i];
								Pname[ttop]=name[i];
								Ptitle[ttop]=title[i];
								Ptype[ttop]=type[i];
								Pcontent[ttop]=content[i];
								Pcreatetime[ttop]=createtime[i];
							}
							//否则，就和栈里的元素一起出栈，排成一排
							else{
								//alert(top);

								var html="<li  style='position:absolute;height:240px;width:180px;top:"+Top+"px;left:-5px'><div class='col-md-4' >";
										html+="<div class='card card-blog'>";
										html+="<div class='card-image'>";
										html+="<a href='#'> <img class='img img-raised'  style='height:180px;width:140px' src='"+Purl[ttop]+"'> </a>";
										html+="<div class='ripple-cont'></div>";
										html+="</div>";
										html+="<div class='table'>";
										html+="<div style='height:20px;overflow:hidden'><a style='font-size:6px !important;}'>"+Pname[ttop]+"</a><br/>";
										html+="<a style='font-size:4px !important;>"+Ptitle[ttop]+"</a><br/><a style='font-size:2px !important;>"+Pcontent[ttop]+"</div>";
										html+="</div>";
										html+="</div>";
										html+="</div></li>";
											$("#uli").append(html);
										ttop--;

										var html="<li style='position:absolute;height:240px;width:180px;top:"+Top+"px;left:155px'><div class='col-md-4'>";
												html+="<div class='card card-blog'>"
												html+="<div class='card-image'>";
												html+="<a href='#'> <img class='img img-raised' style='height:180px;width:140px' src='"+url[i]+"'> </a>";
												html+="<div class='ripple-cont'></div>";
												html+="</div>";
												html+="<div class='table'>";
												html+="<div style='height:20px;overflow:hidden'><a style='font-size:2px'>"+name[i]+"</a></div>";
												html+="</div>";
												html+="</div>";
												html+="</div></li>";
										$("#uli").append(html);

										ulh+=250;
										$("#uli").height(ulh);
										Top+=250;
									}
						}
				}



			});
			//如果有某个时间点不能正常获取数据，就跳过这一天
			setTimeout(function(){
				//alert(tag);
				if(tag==0){


				var time2=time.split(" ");
				var time3=time2[0].split("-");
				time3[2]=time3[2]-1;
				time=time3[0]+"-"+time3[1]+"-"+time3[2]+" "+time2[1];
				//alert(time);
			}

		},1000);

		}




window.onload=function(){
	//$("#mess").hide();
	loadData();
}
window.onresize = function(){
	//loadData();
}
refresher.init({
	id:"wrapper",//<------------------------------------------------------------------------------------┐
	pullDownAction:Refresh,
	pullUpAction:Load
	});

var generatedCount = 0;
function Refresh() {
	setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
		 loadData();
		wrapper.refresh();/****remember to refresh after  action completed！ ---yourId.refresh(); ----| ****/

	}, 500);

}

function Load() {

	setTimeout(function () {// <-- Simulate network congestion, remove setTimeout from production!
		loadData();
		wrapper.refresh();/****rem写ember to refresh after action completed！！！   ---id.refresh(); --- ****/
	}, 500);
}
</script>

</body>
</html>
